# Item Output Standardization – Findings vs. Reality

| Modal / Flow                                                 | UI behaviour (toggle / selection)                                                                            | Data emitted on save                                                                          | Workflow behaviour                                                                                    | Reality gap                                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------- |
| `components/modals/task-modal.tsx`                           | `ItemNameField` toggles between new/existing; selecting existing writes ID back into form state.             | `buildTaskFromForm()` persists `outputItemId` when `isNewItem` is false.                      | `createItemFromTask()` reuses stock on existing item when `outputItemId` is present and marks effect. | ✅ Matches plan – existing items increment stock correctly.                        |
| `components/modals/financials-modal.tsx`                     | Same `ItemNameField` UX; allows picking an existing item.                                                    | `handleSave()` never includes an `outputItemId`; `isNewItem` is passed but unused downstream. | `createItemFromRecord()` always mints a new item; no branch for reuse.                                | ❌ UI suggests reuse is possible but backend ignores it → duplicate items created. |
| `components/modals/sales-modal.tsx` (service lines)          | Item emissary submodal exposes “New/Existing” toggle via `ItemNameField`, but selected IDs aren’t persisted. | `ItemCreationData` returned from submodal only carries name/type fields, no item ID flag.     | When sale spawns a task, the task workflow receives only new-item DNA; reuse path never triggered.    | ⚠️ Toggle is cosmetic; system cannot reuse inventory from sale-generated tasks.   |
| `components/modals/item-modal.tsx`                           | Direct item editor; no concept of emissary reuse.                                                            | N/A                                                                                           | N/A                                                                                                   | ✅ Works as primary inventory editor; not part of reuse story.                     |
| Shared `ItemNameField` (`components/ui/item-name-field.tsx`) | Maintains internal toggle state and surfaces selected item ID via `onItemSelect`.                            | Consumers must persist `selectedItemId` + `isNewItem`.                                        | Only task modal stores both and wires through to workflows.                                           | ❗ Any modal not persisting both values ends up with cosmetic toggle.              |

## Key Standardization Targets

1. **Persist item IDs everywhere**: Financial and sales flows must capture `selectedItemId` alongside `isNewItem` to signal reuse intent.
2. **Extend workflows**: `createItemFromRecord()` and any downstream task creation from sales need parity with task workflow’s reuse branch (stock merge, effects registry).
3. **Align UI messaging**: Until backend supports reuse, either disable the toggle or implement the missing plumbing to avoid misleading behaviour.


